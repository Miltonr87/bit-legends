<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Bit Legends Emulator</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #000;
      }
      #game {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="game"></div>
    <script>
      const params = new URLSearchParams(window.location.search);
      const romUrl = params.get('rom') || '';
      const rawPlatform = (params.get('platform') || '').toLowerCase();
      const PLATFORM_TO_CORE = {
        snes: 'snes',
        supernintendo: 'snes',
        'super-nes': 'snes',
        supernes: 'snes',
        genesis: 'segaMD',
        segamd: 'segaMD',
        megadrive: 'segaMD',
        'mega-drive': 'segaMD',
        md: 'segaMD',
        gen: 'segaMD',
        sega: 'segaMD',
      };
      function inferCoreFromRom(url) {
        const lower = url.toLowerCase().split('?')[0];
        if (/\.(smc|sfc)$/.test(lower)) return 'snes';
        if (/\.(bin|gen|md)$/.test(lower)) return 'segaMD';
        return 'snes'; // safe default
      }
      const requestedCore = PLATFORM_TO_CORE[rawPlatform];
      const core = requestedCore || inferCoreFromRom(romUrl);

      if (!romUrl) {
        document.getElementById('game').innerHTML =
          '<div style="color:#fff;font:16px/1.5 system-ui, sans-serif;padding:20px;">Missing "rom" query param.</div>';
        throw new Error('Missing "rom" query param');
      }
      window.EJS_player = '#game';
      window.EJS_core = core;
      window.EJS_gameUrl = romUrl;
      window.EJS_pathtodata = 'https://www.emulatorjs.com/data/';
      window.EJS_startOnLoaded = true;
    </script>
    <script src="https://www.emulatorjs.com/loader.js"></script>
  </body>
</html>
